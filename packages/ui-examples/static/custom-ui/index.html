<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Static Template</title>
	<script type="module">
		import {
			FindkitUI,
			html,
		} from "https://cdn.findkit.com/ui/v0.8.0-dev.bca2560caa/esm/index.js";

		const ui = new FindkitUI({
			publicToken: "pW1D0p0Dg",
			modal: false,
			container: "#container",
			minTerms: 0,
			params: {sort: {price: {$order: "asc"}}},
			slots: {
				Hit(props) {
					// prettier-ignore
					return html`
						${props.hit.customFields.price?.value} EUR
						${props.children}
					`;
				},
			},

			defaultCustomRouterData: {min: "0", max: "100"},
		});

		const form = document.querySelector("form");

		// Update search params on form changes
		form.addEventListener("input", () => {
			updateSearch();
		});

		// Save form state to the URL when it was used to make a search
		ui.on("fetch", () => {
			ui.setCustomRouterData(Object.fromEntries(new FormData(form)));
		});

		// Restore form state from the URL on page load and navigations
		ui.on("custom-router-data", (e) => {
			// Fill form inputs
			for (const [name, value] of Object.entries(e.data)) {
				form.elements.namedItem(name).value = value;
			}

			// Update search from here too since programmatic form update
			// does not trigger the "input" events
			updateSearch();
		});

		function updateSearch() {
			ui.updateParams((params) => {
				const data = Object.fromEntries(new FormData(form));

				const $and = [];

				if (data.min) {
					$and.push({price: {$gte: data.min}});
				}

				if (data.max) {
					$and.push({price: {$lte: data.max}});
				}

				params.filter.$and = $and;
			});
	</script>
</head>

<body>
	<form>
		<label>Min <input type="number" name="min" step="10" /></label>
		<label>Max <input type="number" name="max" step="10" /></label>
		<a href="?">Reset</a>
	</form>

	<div id="container"></div>
</body>

</html>
